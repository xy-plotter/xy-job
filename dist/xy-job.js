var e,t=(e=require("tiny-emitter"))&&"object"==typeof e&&"default"in e?e.default:e,n="undefined"!=typeof window&&void 0!==window.document,u={black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39]},i={};if(!n){var o=function(e){var t="["+u[e][0]+"m",n="["+u[e][1]+"m";i[e]=function(e){return console.log(t+e+n)}};for(var r in u)o(r)}var s=console.log,h=n?console.log:i.green,a=n?console.warn:i.yellow,p=n?console.error:i.error,c=function(e,t,n,u){return u(t+" "+e+" "+n)},d=function(e){void 0===e&&(e={}),this.prefix="[xy-job]",this.suffix="(job: "+e.job+")"||""};d.prototype.info=function(e){return c(e,this.prefix,this.suffix,s)},d.prototype.warn=function(e){return c(e,this.prefix+" Warning:",this.suffix,a)},d.prototype.error=function(e){return c(e,this.prefix+" Error:",this.suffix,p)},d.prototype.success=function(e){return c(e,this.prefix+" Success:",this.suffix,h)};var f="job",E="",S="_",q=function(e){return+e<10?"0"+e:""+e};function v(e){return e.length>1?e:(t=new Date,n=t.getFullYear(),u=q(t.getMonth()),i=q(t.getDate()),o=q(t.getHours()),r=q(t.getMinutes()),s=q(t.getSeconds()),h=t.getMilliseconds(),a=Math.floor(999999*Math.random()),p="",p+=f+S,p+=n+E+u+E+i,p+=S,p+=o+E+r+E+s,p+=S,p+=h,p+=S,p+=a);var t,n,u,i,o,r,s,h,a,p}var l=function(e){return void 0===e&&(e=2),function(t){void 0===t&&(t=0);var n=(t+"e").split("e");return+((n=(Math.round(n[0]+"e"+(+n[1]+e))+"e").split("e"))[0]+"e"+(+n[1]-e))}},y={HOME:function(){return["HOME"]},MOVE:function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),["MOVE",+e,+t]},PEN:function(e){return void 0===e&&(e=0),["PEN",e]},SPEED:function(e){return void 0===e&&(e=0),["SPEED",+e]},SPEED_RESET:function(){return["SPEED_RESET"]},WAIT:function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),["WAIT",e+"",t+""]},END:function(){return["END"]}},g=function(e){return"Job instruction "+e+" is invalid."},b=function(e){return"Job already ended. Can't enqueue "+e+" instruction."},w=function(e,t){return"Move to to out-of-bounds coordinates: "+e+";"+t+"."},M=function(){return"Speed value must be between 0 and 1. Leaving speed setting unchanged."},x={name:"",canvasWidth:380,canvasHeight:310,penUp:0,penDown:30,precision:3},D=function(e){function t(t){void 0===t&&(t={}),e.call(this),t=Object.assign({},x,t),this.name=v(t.name),this.round=l(0|t.precision),this.bounds={canvas:[this.round(t.canvasWidth),this.round(t.canvasHeight)],pen:[this.round(t.penUp),this.round(t.penDown)]},this.logger=new d({job:this.name}),this.warn=this.logger.warn.bind(this.logger),this.queue=[],this.queueState={ended:!1,x:0,y:0,pen:this.bounds.pen[0],speed:"auto"},this.reset()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.canEnqueue=function(e){return this.queueState.ended?this.warn(b(e))&&!1:!(e&&!y[e])||this.warn(g(e))&&!1},t.prototype.enqueue=function(e,t,n){return this.canEnqueue(e)?(isNaN(t)||(t=this.round(t)),isNaN(n)||(n=this.round(n)),"MOVE"===e?(this.queueState.x=t,this.queueState.y=n):"PEN"===e?this.queueState.pen=t:"END"===e?this.queueState.ended=!0:"SPEED_RESET"===e?this.queueState.speed="auto":"SPEED"===e&&(this.queueState.speed=t),this.queue.push(y[e](t,n)),this):this},t.prototype.reset=function(){return this.canEnqueue("HOME")?(this.penUp(!0),this.resetSpeed(),this.queueState.x=0,this.queueState.y=0,this.enqueue("HOME")):this},t.prototype.pen=function(e){return this.queueState.pen!==this.round(e)?this:this.enqueue("PEN",e)},t.prototype.penUp=function(){return this.pen(this.bounds.pen[0])},t.prototype.penDown=function(){return this.pen(this.bounds.pen[1])},t.prototype.setSpeed=function(e){if(void 0===e||"auto"===e||isNaN(e))return this.resetSpeed();if(e<0||e>1)return this.warn(M()),this;var t=1100-1e3*e;return this.queueState.speed!==this.round(t)&&this.enqueue("SPEED",t),this},t.prototype.resetSpeed=function(){return"auto"!==this.queueState.speed&&this.enqueue("SPEED_RESET"),this},t.prototype.move=function(e,t){if(!this.canEnqueue("MOVE"))return this;(e<0||e>this.bounds.canvas[0]||t<0||t>this.bounds.canvas[1])&&this.warn(w(e,t));for(var n=[e-this.queueState.x,t-this.queueState.y],u=Math.max(Math.max(n[0],n[1])/150,1),i=[this.round(n[0]/u),this.round(n[1]/u)];Math.abs(n[0])>150||Math.abs(n[1])>150;)n[0]-=i[0],n[1]-=i[1],this.enqueue("MOVE",this.queueState.x+i[0],this.queueState.y+i[1]);return this.queueState.x===this.round(e)&&this.queueState.y===this.round(t)||this.enqueue("MOVE",e,t),this},t.prototype.wait=function(e,t){return this.enqueue("WAIT",e,t)},t.prototype.end=function(){return this.enqueue("END")},t}(t);module.exports=D;
